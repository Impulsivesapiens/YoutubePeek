/* ================================================== */
/* === 1. PEEK UI ELEMENTS (The Buttons & Modal) === */
/* ================================================== */

/* The "Peek" Button on Thumbnails */
.yt-peek-btn {
    position: absolute; top: 5px; right: 5px; z-index: 2000;
    width: 28px; height: 28px; 
    background: rgba(0,0,0,0.6); /* Darker for better visibility */
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    cursor: pointer; opacity: 0; transition: all 0.2s; 
    backdrop-filter: blur(3px);
    border: 1px solid rgba(255,255,255,0.3);
}
.yt-peek-btn svg { width: 16px; height: 16px; fill: white; }

/* Show button on hover (Handles both old and new YouTube layouts) */
.yt-lockup-view-model__content-image:hover .yt-peek-btn, 
ytd-thumbnail:hover .yt-peek-btn, 
a#thumbnail:hover .yt-peek-btn, 
a:hover > .yt-peek-btn { 
    opacity: 1; 
}
.yt-peek-btn:hover { background: rgba(255, 0, 0, 0.8); transform: scale(1.1); border-color: white; }

/* The Modal Container (Injector Page) */
.yt-peek-overlay {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.85); z-index: 99999; /* Highest possible */
    display: flex; justify-content: center; align-items: center;
    backdrop-filter: blur(5px);
}
.yt-peek-container {
    position: relative; width: 80%; max-width: 1200px; aspect-ratio: 16/9;
    background: black; box-shadow: 0 0 50px rgba(0,0,0,0.8); 
    border-radius: 12px; overflow: hidden;
}
.yt-peek-iframe { width: 100%; height: 100%; border: none; }


/* ================================================== */
/* === 2. ZEN MODE (Inside the Iframe)             === */
/* ================================================== */
/* This logic only applies when body id="peek-body" */

/* A. SET THE STAGE TO BLACK */
body#peek-body, 
body#peek-body ytd-app, 
body#peek-body ytd-watch-flexy,
body#peek-body #columns,
body#peek-body #primary,
body#peek-body #player {
    background: black !important;
    overflow: hidden !important; /* Disable scrolling completely */
    min-height: 100vh !important;
}

/* B. THE SPOTLIGHT (Structural Filtering) */
/* Logic: "If a container holds the player, keep it. 
   If a sibling container does NOT hold the player, hide it."
   This automatically kills sidebars, comments, and shelves without knowing their IDs. */

/* 1. Base Cleanup: Global elements that are never parents of the player */
body#peek-body ytd-masthead, 
body#peek-body tp-yt-app-drawer,
body#peek-body #masthead-container {
    display: none !important;
}

/* 2. Watch Page Root: Hide anything that isn't the main column structure */
body#peek-body ytd-watch-flexy > :not(:has(#movie_player)) {
    display: none !important;
}

/* 3. Columns Wrapper: Hide the sidebar (#secondary) automatically */
/* We target the children of #columns. Only the one containing #movie_player survives. */
body#peek-body #columns > :not(:has(#movie_player)) {
    display: none !important;
}

/* 4. Primary Column: Hide comments, metadata, and merch shelves (#primary children) */
/* Usually #player-container is the only child here that holds #movie_player */
body#peek-body #primary > :not(:has(#movie_player)) {
    display: none !important;
}

/* 5. Player Wrapper: Hide any unexpected siblings inside the player container */
body#peek-body #player > :not(:has(#movie_player)) {
    display: none !important;
}

/* C. FORCE PLAYER TO FULL VIEWPORT */
/* We physically stretch the player container to fill the screen. */
body#peek-body #player-container-outer,
body#peek-body #player-container-inner,
body#peek-body #player-container,
body#peek-body #ytd-player,
body#peek-body #container,
body#peek-body #movie_player {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    max-height: none !important;
    margin: 0 !important;
    padding: 0 !important;
    z-index: 100 !important; /* Sufficient since everything else is hidden */
    background: black !important;
}

/* D. STRETCH THE VIDEO ELEMENT */
body#peek-body video.video-stream,
body#peek-body .html5-main-video {
    width: 100vw !important;
    height: 100vh !important;
    left: 0 !important;
    top: 0 !important;
    object-fit: contain !important; /* Ensures whole video is visible */
}

/* E. ADJUST CONTROLS POSITION */
/* Since the player is full width, we need to ensure controls aren't cut off */
body#peek-body .ytp-chrome-bottom {
    width: 98% !important;
    left: 1% !important;
    bottom: 10px !important;
}

/* G. HIDE END SCREEN CLUTTER (UPDATED) */
body#peek-body .ytp-endscreen-content,              /* The main thumbnail wall */
body#peek-body .ytp-ce-element,                     /* Floating end cards */
body#peek-body .ytp-upnext,                         /* "Up Next" circle */
body#peek-body .ytp-autonav-endscreen-button-container, 
body#peek-body .ytp-pause-overlay,                  /* Pause screen suggestions */
body#peek-body .ytp-pause-overlay-container,        /* Wrapper for pause screen */                  /* Main endscreen container */
body#peek-body .ytp-related-panel,                  /* Drawer that slides up */
body#peek-body .ytp-suggestion-set,                 /* Suggestion sets */
body#peek-body .ytp-cued-thumbnail-overlay,         /* Main thumbnail wall */
body#peek-body .html5-endscreen { /* NEW: Hides the main videowall */
    display: none !important;
}

/* H. CUSTOM PEEK CONTROLS (Top Right) */
#peek-controls {
    position: fixed; top: 20px; right: 20px;
    z-index: 2147483647 !important; /* Max Z-Index */
    display: flex; gap: 10px;
    opacity: 0; /* Hidden by default */
    transition: opacity 0.3s ease-in-out;
    pointer-events: none; /* Let clicks pass through when hidden */
}

/* 1. Show when JS detects activity */
body#peek-body.peek-ui-active #peek-controls {
    opacity: 1;
    pointer-events: auto; /* Re-enable clicks */
}

/* 2. ALWAYS show when hovering the buttons themselves (overrides timer) */
#peek-controls:hover {
    opacity: 1 !important;
    pointer-events: auto;
}

/* Button Styling (Unchanged, just ensuring pointer-events are safe) */
.peek-ctrl-btn {
    width: 40px; height: 40px;
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    backdrop-filter: blur(4px);
    pointer-events: auto; /* Ensure buttons are clickable */
}
.peek-ctrl-btn:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }
.peek-ctrl-btn svg { width: 20px; height: 20px; fill: white; }

/* H. EXIT ANIMATION (The "Little Animation") */
@keyframes peekFadeOut {
    0% { opacity: 1; }
    100% { opacity: 0; }
}

body#peek-body.peek-closing {
    /* Since the container behind the iframe is black, lowering opacity creates a "Fade to Black" */
    animation: peekFadeOut 1.0s ease-in-out forwards; 
    pointer-events: none !important;
}

/* === I. ZEN MAXIMIZE (The "Perfect Math" Fullscreen) === */

/* 1. Hide the Native Fullscreen Button (It breaks the scrubber math) */
body#peek-body .ytp-fullscreen-button {
    display: none !important;
}

/* 2. The Maximized State (Applied to .yt-peek-container) */
/* This overrides the default 80% width / 16:9 ratio to fill the screen */
.yt-peek-container.peek-maximized {
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    border-radius: 0 !important;
    top: 0 !important;
    left: 0 !important;
    position: fixed !important;
}

/* 3. Ensure the Iframe fills the maximized container */
.yt-peek-container.peek-maximized .yt-peek-iframe {
    width: 100vw !important;
    height: 100vh !important;
}